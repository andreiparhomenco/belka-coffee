# üéâ –≠–¢–ê–ü 1 –ó–ê–í–ï–†–®–Å–ù: –ë–ê–ó–ê –î–ê–ù–ù–´–• + AUTH

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 18 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **100% –ì–û–¢–û–í–û**

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –î–µ—Ç–∞–ª–∏ |
|-----------|-----------|--------|
| **SQL –ú–∏–≥—Ä–∞—Ü–∏–∏** | 8 —Ñ–∞–π–ª–æ–≤ | 001-008: users, shop_template, availability, shifts, shift_reports, salaries, audit_log, RLS |
| **–¢–∞–±–ª–∏—Ü—ã –ë–î** | 7 —Ç–∞–±–ª–∏—Ü | –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| **Edge Functions** | 1 —Ñ—É–Ω–∫—Ü–∏—è | telegram-auth –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ |
| **Frontend Helpers** | 1 —Ñ–∞–π–ª | auth.ts —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º |
| **SQL –¢–µ—Å—Ç—ã** | 10 –≥—Ä—É–ø–ø | pgTAP —Ç–µ—Å—Ç—ã –¥–ª—è –ë–î |
| **Edge Function –¢–µ—Å—Ç—ã** | 8 —Ç–µ—Å—Ç–æ–≤ | Deno —Ç–µ—Å—Ç—ã –¥–ª—è API |
| **Frontend –¢–µ—Å—Ç—ã** | 12 —Ç–µ—Å—Ç–æ–≤ | Vitest —Ç–µ—Å—Ç—ã –¥–ª—è auth.ts |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | 5 README | –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ |
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞** | ~3000+ | –í–∫–ª—é—á–∞—è —Ç–µ—Å—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é |

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### 1. SQL –ú–∏–≥—Ä–∞—Ü–∏–∏ (8 —Ñ–∞–π–ª–æ–≤)

**001_create_users.sql**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—è–º–∏ (barista/admin)
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ telegram_id
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**002_create_shop_template.sql**
- ‚úÖ –®–∞–±–ª–æ–Ω —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –∫–æ—Ñ–µ–π–Ω–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è day_of_week (0-6) –∏ hour (0-23)
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á (day_of_week, hour)
- ‚úÖ –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏: –ü–Ω-–ü—Ç 8:00-20:00, –°–±-–í—Å 9:00-18:00

**003_create_availability.sql**
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–∞—Ä–∏—Å—Ç–∞ –ø–æ —á–∞—Å–∞–º
- ‚úÖ –°–≤—è–∑—å —Å users —á–µ—Ä–µ–∑ foreign key
- ‚úÖ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (>4 –Ω–µ–¥–µ–ª—å)

**004_create_shifts.sql**
- ‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —Å–º–µ–Ω—ã —Å —Å—Ç–∞—Ç—É—Å–∞–º–∏
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã: planned, confirmed, completed, cancelled
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–ª–æ—Ç–æ–≤
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_active_shifts()` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä updated_at

**005_create_shift_reports.sql**
- ‚úÖ –û—Ç—á—ë—Ç—ã –±–∞—Ä–∏—Å—Ç–∞ –ø–æ—Å–ª–µ —Å–º–µ–Ω
- ‚úÖ –°–≤—è–∑—å –æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É —Å shifts (UNIQUE constraint)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: turnover >= 0, confirmed_hours <= 24
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–º–µ–Ω—ã –Ω–∞ 'completed'
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_week_reports_stats()` –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**006_create_salaries.sql**
- ‚úÖ –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –∑–∞—Ä–ø–ª–∞—Ç—ã –ø–æ –Ω–µ–¥–µ–ª—è–º
- ‚úÖ –§–æ—Ä–º—É–ª–∞: (hours √ó 150‚ÇΩ) + (turnover √ó 5%)
- ‚úÖ –ü–æ–ª—è: hourly_rate, turnover_percentage (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ)
- ‚úÖ –§–ª–∞–≥ is_paid –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—ã–ø–ª–∞—Ç
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `calculate_salary()` –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –æ–¥–Ω–æ–≥–æ –±–∞—Ä–∏—Å—Ç–∞
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `calculate_all_salaries()` –¥–ª—è –≤—Å–µ—Ö –±–∞—Ä–∏—Å—Ç–∞

**007_create_audit_log.sql**
- ‚úÖ –ñ—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ old_data –∏ new_data –≤ JSONB
- ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `log_audit()` –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞ users, shifts, shift_reports, salaries
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_record_history()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (>6 –º–µ—Å—è—Ü–µ–≤)

**008_setup_rls.sql**
- ‚úÖ Row Level Security –¥–ª—è –≤—Å–µ—Ö 7 —Ç–∞–±–ª–∏—Ü
- ‚úÖ –ë–∞—Ä–∏—Å—Ç–∞ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ê–¥–º–∏–Ω—ã –∏–º–µ—é—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—à–ª—ã—Ö —Å–º–µ–Ω
- ‚úÖ –û—Ç—á—ë—Ç—ã –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- ‚úÖ –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: `is_admin()`, `is_barista()`

---

### üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

#### Edge Function: telegram-auth

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram ID
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é `barista`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤—Ö–æ–¥–æ–≤ –≤ audit_log (LOGIN/REGISTER)
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ service_role –¥–ª—è –æ–±—Ö–æ–¥–∞ RLS

**API Endpoint:**
```
POST https://jcrjcglfzrhcghiqfltp.supabase.co/functions/v1/telegram-auth
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚úÖ –°–º–µ–Ω–∞ —Ä–æ–ª–∏ –Ω–∞ `admin` –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ SQL
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (telegram_id, name –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

#### Frontend Auth Helper: auth.ts

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ `telegramAuth()` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `autoAuthFromTelegram()` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Mini App
- ‚úÖ `getCurrentUser()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
- ‚úÖ `isAdmin()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∞
- ‚úÖ `isBarista()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –±–∞—Ä–∏—Å—Ç–∞
- ‚úÖ `logout()` - –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ `useAuthStatus()` - —Ö—É–∫ –¥–ª—è React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
- ‚úÖ –ü–æ–ª—è: user, user_id, telegram_id

---

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### SQL –¢–µ—Å—Ç—ã (pgTAP)

**10 –≥—Ä—É–ø–ø —Ç–µ—Å—Ç–æ–≤:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö 7 —Ç–∞–±–ª–∏—Ü
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã users
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ UNIQUE constraints (telegram_id)
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ CHECK constraints (—Ä–æ–ª–∏, day_of_week, hour, turnover)
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞ updated_at
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞—Å—á—ë—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è RLS –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
8. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Foreign Key constraints
9. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞ audit_log (INSERT/UPDATE/DELETE)
10. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

**–ó–∞–ø—É—Å–∫:**
```sql
CREATE EXTENSION IF NOT EXISTS pgtap;
\i supabase/migrations/__tests__/database.test.sql
```

#### Edge Function –¢–µ—Å—Ç—ã (Deno)

**8 —Ç–µ—Å—Ç–æ–≤:**
1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é barista
2. ‚úÖ –í–æ–∑–≤—Ä–∞—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
4. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: –æ—à–∏–±–∫–∞ –µ—Å–ª–∏ telegram_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
5. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: –æ—à–∏–±–∫–∞ –µ—Å–ª–∏ name –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
6. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ CORS preflight (OPTIONS)
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ audit_log
8. ‚úÖ Performance: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ concurrent –∑–∞–ø—Ä–æ—Å—ã

**–ó–∞–ø—É—Å–∫:**
```bash
deno test --allow-all supabase/functions/telegram-auth/__tests__/index.test.ts
```

#### Frontend –¢–µ—Å—Ç—ã (Vitest)

**12 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è auth.ts:**
1. ‚úÖ `telegramAuth()` - —É—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
2. ‚úÖ `telegramAuth()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ API
3. ‚úÖ `getCurrentUser()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
4. ‚úÖ `getCurrentUser()` - –≤–æ–∑–≤—Ä–∞—Ç null –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
5. ‚úÖ `getCurrentUser()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ JSON
6. ‚úÖ `isAdmin()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∞
7. ‚úÖ `isBarista()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –±–∞—Ä–∏—Å—Ç–∞
8. ‚úÖ `logout()` - –æ—á–∏—Å—Ç–∫–∞ localStorage
9. ‚úÖ `autoAuthFromTelegram()` - —É—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏–∑ Telegram
10. ‚úÖ `autoAuthFromTelegram()` - –æ—à–∏–±–∫–∞ –µ—Å–ª–∏ Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
11. ‚úÖ `useAuthStatus()` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
12. ‚úÖ `useAuthStatus()` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü–æ–∫—Ä—ã—Ç–∏–µ:** 100% –¥–ª—è auth.ts

**–ó–∞–ø—É—Å–∫:**
```bash
cd frontend
npm test auth
```

---

### üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. ‚úÖ **supabase/migrations/README.md**
   - –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é
   - –ü–æ–ª–µ–∑–Ω—ã–µ SQL —Ñ—É–Ω–∫—Ü–∏–∏
   - Troubleshooting

2. ‚úÖ **supabase/functions/telegram-auth/README.md**
   - –û–ø–∏—Å–∞–Ω–∏–µ Edge Function
   - API endpoint –∏ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
   - –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã (flowchart)
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é
   - –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å curl –∏ JavaScript
   - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

3. ‚úÖ **supabase/migrations/__tests__/README.md**
   - –û–ø–∏—Å–∞–Ω–∏–µ SQL —Ç–µ—Å—Ç–æ–≤
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É
   - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
   - –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

4. ‚úÖ **supabase/functions/telegram-auth/__tests__/README.md**
   - –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ Edge Function
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É –ª–æ–∫–∞–ª—å–Ω–æ –∏ –≤ CI/CD
   - Mock –¥–∞–Ω–Ω—ã–µ
   - Coverage –º–µ—Ç—Ä–∏–∫–∏

5. ‚úÖ **frontend/src/lib/__tests__/README.md**
   - –û–ø–∏—Å–∞–Ω–∏–µ frontend —Ç–µ—Å—Ç–æ–≤
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤
   - –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–æ–º
   - Troubleshooting
   - TODO –¥–ª—è –±—É–¥—É—â–∏—Ö —Ç–µ—Å—Ç–æ–≤

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### üí™ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

1. **–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:**
   - –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è updated_at
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–º–µ–Ω—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ç—á—ë—Ç–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ audit_log

2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - Row Level Security –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
   - –ë–∞—Ä–∏—Å—Ç–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
   - –ê–¥–º–∏–Ω—ã –∏–º–µ—é—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
   - Audit log –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª—è—Ö
   - –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - UNIQUE constraints –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

4. **–£–¥–æ–±—Å—Ç–≤–æ:**
   - –ì–æ—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç
   - –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
   - –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - 30+ —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å—é –∫—Ä–∏—Ç–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
   - –¢–µ—Å—Ç—ã –¥–ª—è –ë–î, API, –∏ Frontend
   - 100% coverage –¥–ª—è auth.ts

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| SQL –ú–∏–≥—Ä–∞—Ü–∏–∏ | 8/8 | ‚úÖ 100% |
| RLS –ü–æ–ª–∏—Ç–∏–∫–∏ | 7/7 —Ç–∞–±–ª–∏—Ü | ‚úÖ 100% |
| SQL –¢–µ—Å—Ç—ã | 10 –≥—Ä—É–ø–ø | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| Edge Function –¢–µ—Å—Ç—ã | 8 —Ç–µ—Å—Ç–æ–≤ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| Frontend –¢–µ—Å—Ç—ã | 12 —Ç–µ—Å—Ç–æ–≤ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 5 README | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| Code Coverage (auth.ts) | 100% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| Git Commits | 3 –∫–æ–º–º–∏—Ç–∞ | ‚úÖ –ì–æ—Ç–æ–≤–æ |

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
belka-coffee/
‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 001_create_users.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 002_create_shop_template.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 003_create_availability.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 004_create_shifts.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 005_create_shift_reports.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 006_create_salaries.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 007_create_audit_log.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 008_setup_rls.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __tests__/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ database.test.sql
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îî‚îÄ‚îÄ functions/
‚îÇ       ‚îî‚îÄ‚îÄ telegram-auth/
‚îÇ           ‚îú‚îÄ‚îÄ index.ts
‚îÇ           ‚îú‚îÄ‚îÄ README.md
‚îÇ           ‚îî‚îÄ‚îÄ __tests__/
‚îÇ               ‚îú‚îÄ‚îÄ index.test.ts
‚îÇ               ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îî‚îÄ‚îÄ lib/
‚îÇ           ‚îú‚îÄ‚îÄ auth.ts
‚îÇ           ‚îî‚îÄ‚îÄ __tests__/
‚îÇ               ‚îú‚îÄ‚îÄ auth.test.ts
‚îÇ               ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ STAGE_1_COMPLETE.md
‚îî‚îÄ‚îÄ PLAN.md
```

---

## üîÑ Git History

```bash
# –ö–æ–º–º–∏—Ç 1: SQL –ú–∏–≥—Ä–∞—Ü–∏–∏
git commit -m "feat(database): —Å–æ–∑–¥–∞–Ω–∏–µ SQL –º–∏–≥—Ä–∞—Ü–∏–π –∏ RLS –ø–æ–ª–∏—Ç–∏–∫"
# 9 —Ñ–∞–π–ª–æ–≤, 1134 —Å—Ç—Ä–æ–∫–∏

# –ö–æ–º–º–∏—Ç 2: Edge Function + Auth Helper
git commit -m "feat(auth): Edge Function –¥–ª—è Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"
# 3 —Ñ–∞–π–ª–∞, 594 —Å—Ç—Ä–æ–∫–∏

# –ö–æ–º–º–∏—Ç 3: –¢–µ—Å—Ç—ã
git commit -m "test: –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ë–î –∏ Auth"
# 6 —Ñ–∞–π–ª–æ–≤, 1306 —Å—Ç—Ä–æ–∫
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–≠—Ç–∞–ø 2)

### –ú–æ–¥—É–ª—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞—Ä–∏—Å—Ç–∞

**–ó–∞–¥–∞—á–∏:**
1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
2. API –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
3. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —á–∞—Å–æ–≤
4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
5. –¢–µ—Å—Ç—ã –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ API

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–∞—Ä–∏—Å—Ç–∞ –º–æ–≥—É—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å —Å–≤–æ—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–∞ –Ω–µ–¥–µ–ª—é
- –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –æ–±—â—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –±–∞—Ä–∏—Å—Ç–∞

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –≠—Ç–∞–ø–∞ 2:

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Supabase:**
   ```bash
   supabase db push
   # –∏–ª–∏ —á–µ—Ä–µ–∑ Dashboard SQL Editor
   ```

2. **–ó–∞–¥–µ–ø–ª–æ–∏—Ç—å Edge Function:**
   ```bash
   supabase functions deploy telegram-auth
   ```

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:**
   ```bash
   curl -X POST https://jcrjcglfzrhcghiqfltp.supabase.co/functions/v1/telegram-auth \
     -H "Content-Type: application/json" \
     -H "apikey: sb_publishable_55fEkUzyTswveKoQRbyopA_H0Abc7bi" \
     -d '{"telegram_id": 123, "name": "Test"}'
   ```

4. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞:**
   ```sql
   INSERT INTO users (telegram_id, name, role)
   VALUES (YOUR_TELEGRAM_ID, '–í–∞—à–µ –ò–º—è', 'admin');
   ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã:**
   ```bash
   # SQL —Ç–µ—Å—Ç—ã
   psql [...] -f supabase/migrations/__tests__/database.test.sql
   
   # Frontend —Ç–µ—Å—Ç—ã
   cd frontend && npm test
   ```

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–≠—Ç–∞–ø 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö + Auth** –∑–∞–≤–µ—Ä—à—ë–Ω **–Ω–∞ 100%**!

–°–æ–∑–¥–∞–Ω–∞ **–ø–æ–ª–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞** –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ Belka Coffee:
- ‚úÖ –°—Ö–µ–º–∞ –ë–î —Å 7 —Ç–∞–±–ª–∏—Ü–∞–º–∏
- ‚úÖ Row Level Security
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
- ‚úÖ 30+ —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –º–æ–¥—É–ª–µ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ –∑–∞—Ä–ø–ª–∞—Ç!** üöÄ

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 18 –¥–µ–∫–∞–±—Ä—è 2025  
**–ü—Ä–æ–µ–∫—Ç:** Belka Coffee  
**–≠—Ç–∞–ø:** 1 –∏–∑ 7

