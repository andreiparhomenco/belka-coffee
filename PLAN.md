# üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ Belka Coffee

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 15 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –í –æ–∂–∏–¥–∞–Ω–∏–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

---

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –∏ –∑–∞—Ä–ø–ª–∞—Ç–∞–º–∏ –±–∞—Ä–∏—Å—Ç–∞ —á–µ—Ä–µ–∑ Telegram Mini App

**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Telegram Mini App  
**Frontend:** React + Vite  
**Backend:** Supabase (PostgreSQL + Edge Functions)  
**–•–æ—Å—Ç–∏–Ω–≥:** Vercel

---

## üìä –û–±—â–∏–π Timeline

| –≠—Ç–∞–ø | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------------|----------|
| **–≠—Ç–∞–ø 0** | 1 –¥–µ–Ω—å | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è |
| **–≠—Ç–∞–ø 1** | 2-3 –¥–Ω—è | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö + Auth |
| **–≠—Ç–∞–ø 2** | 3-4 –¥–Ω—è | Frontend MVP (–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å) |
| **–≠—Ç–∞–ø 3** | 4-5 –¥–Ω–µ–π | –ê–ª–≥–æ—Ä–∏—Ç–º –≥—Ä–∞—Ñ–∏–∫–∞ |
| **–≠—Ç–∞–ø 4** | 5-6 –¥–Ω–µ–π | –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å |
| **–≠—Ç–∞–ø 5** | 3-4 –¥–Ω—è | –°–º–µ–Ω—ã –∏ –æ—Ç—á—ë—Ç—ã |
| **–≠—Ç–∞–ø 6** | 2-3 –¥–Ω—è | –ó–∞—Ä–ø–ª–∞—Ç—ã |
| **–≠—Ç–∞–ø 7** | 2-3 –¥–Ω—è | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| **–≠—Ç–∞–ø 8** | 2 –¥–Ω—è | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ª–æ–≥–∏ |
| **–≠—Ç–∞–ø 9** | 3-4 –¥–Ω—è | E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **–≠—Ç–∞–ø 10** | 2-3 –¥–Ω—è | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –¥–µ–ø–ª–æ–π |

**–û–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 29-38 –¥–Ω–µ–π (1-1.5 –º–µ—Å—è—Ü–∞)

---

## üß™ –ß–ê–°–¢–¨ 1: –°–¢–†–ê–¢–ï–ì–ò–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **Test-Driven Development (TDD):** –¢–µ—Å—Ç—ã –ø–∏—à—É—Ç—Å—è –î–û —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
2. **–ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞:** –ú–∏–Ω–∏–º—É–º 80% –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π
3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** CI/CD –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ
4. **–ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - 70% Unit —Ç–µ—Å—Ç—ã
   - 20% Integration —Ç–µ—Å—Ç—ã
   - 10% E2E —Ç–µ—Å—Ç—ã

### 1.1 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Backend

#### –ú–æ–¥—É–ª—å: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Schema)

**Unit —Ç–µ—Å—Ç—ã:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –∏ —Å–≤—è–∑–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ constraints (hour –æ—Ç 0 –¥–æ 23, turnover >= 0)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (telegram_id, availability slots)

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```sql
-- TC-DB-001: –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
INSERT INTO users (telegram_id, name, role) VALUES (123456, '–ò–≤–∞–Ω', 'barista');
-- –û–∂–∏–¥–∞–Ω–∏–µ: success

-- TC-DB-002: –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç telegram_id
INSERT INTO users (telegram_id, name, role) VALUES (123456, '–ú–∞—Ä–∏—è', 'barista');
-- –û–∂–∏–¥–∞–Ω–∏–µ: ERROR - duplicate key

-- TC-DB-003: –°–æ–∑–¥–∞—Ç—å availability —Å hour = 25
INSERT INTO availability (user_id, week_start, day_of_week, hour) 
VALUES (..., '2025-01-13', 0, 25);
-- –û–∂–∏–¥–∞–Ω–∏–µ: ERROR - check constraint violation

-- TC-DB-004: –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
DELETE FROM users WHERE id = '...';
-- –û–∂–∏–¥–∞–Ω–∏–µ: –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ availability, shifts —É–¥–∞–ª–µ–Ω—ã
```

---

#### –ú–æ–¥—É–ª—å: Row Level Security (RLS)

**Security —Ç–µ—Å—Ç—ã:**
- ‚úÖ –ë–∞—Ä–∏—Å—Ç–∞ –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ë–∞—Ä–∏—Å—Ç–∞ –ù–ï –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–∏—Ö –±–∞—Ä–∏—Å—Ç–∞
- ‚úÖ –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-RLS-001: –ë–∞—Ä–∏—Å—Ç–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å availability –¥—Ä—É–≥–æ–≥–æ –±–∞—Ä–∏—Å—Ç–∞
await supabase.from('availability')
  .select()
  .eq('user_id', 'other_user_id');
// –û–∂–∏–¥–∞–Ω–∏–µ: [] (–ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤)

// TC-RLS-002: –ê–¥–º–∏–Ω —á–∏—Ç–∞–µ—Ç –≤—Å–µ shifts
await supabase.from('shifts').select();
// –û–∂–∏–¥–∞–Ω–∏–µ: –≤—Å–µ —Å–º–µ–Ω—ã –≤—Å–µ—Ö –±–∞—Ä–∏—Å—Ç–∞

// TC-RLS-003: –ë–∞—Ä–∏—Å—Ç–∞ –ø—ã—Ç–∞–µ—Ç—Å—è UPDATE —á—É–∂—É—é —Å–º–µ–Ω—É
await supabase.from('shifts')
  .update({ status: 'completed' })
  .eq('id', 'other_user_shift_id');
// –û–∂–∏–¥–∞–Ω–∏–µ: 0 rows updated –∏–ª–∏ –æ—à–∏–±–∫–∞
```

---

#### –ú–æ–¥—É–ª—å: API Functions

**–§—É–Ω–∫—Ü–∏—è: `submitAvailability(userId, weekStart, slots[])`**

**Unit —Ç–µ—Å—Ç—ã:**
- ‚úÖ –£—Å–ø–µ—à–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: slots —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ —á–∞—Å—ã 0-23
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: weekStart –Ω–µ –≤ –ø—Ä–æ—à–ª–æ–º
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø–∏—Å—å —Å—Ç–∞—Ä–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–ª—è —Ç–æ–π –∂–µ –Ω–µ–¥–µ–ª–∏
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-API-001: –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
await submitAvailability('user-123', '2025-01-13', [
  { day: 0, hour: 8 },
  { day: 0, hour: 9 },
  { day: 1, hour: 10 }
]);
// –û–∂–∏–¥–∞–Ω–∏–µ: { success: true, slotsCreated: 3 }

// TC-API-002: –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —á–∞—Å
await submitAvailability('user-123', '2025-01-13', [
  { day: 0, hour: 25 }
]);
// –û–∂–∏–¥–∞–Ω–∏–µ: { error: 'Invalid hour: 25' }

// TC-API-003: –ü—Ä–æ—à–ª–∞—è –¥–∞—Ç–∞
await submitAvailability('user-123', '2024-01-01', [...]);
// –û–∂–∏–¥–∞–Ω–∏–µ: { error: 'Cannot set availability for past weeks' }
```

---

**–§—É–Ω–∫—Ü–∏—è: `generateSchedule(weekStart)`**

**Unit —Ç–µ—Å—Ç—ã:**
- ‚úÖ –í—Å–µ —Å–ª–æ—Ç—ã –∏–∑ —à–∞–±–ª–æ–Ω–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã (–µ—Å–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞—Ä–∏—Å—Ç–∞)
- ‚úÖ –ë–∞—Ä–∏—Å—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ —á–∞—Å—ã, –∫–æ–≥–¥–∞ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω
- ‚úÖ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∞—Å–æ–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ (–ø–µ—Ä–µ–∫–æ—Å ‚â§ 30%)
- ‚úÖ –°–ª–æ—Ç—ã —Å –º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–∞—Ä–∏—Å—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –æ–±—Ä–∞–±–æ—Ç–∫–∞ 100 –±–∞—Ä–∏—Å—Ç–∞ + 168 —Å–ª–æ—Ç–æ–≤ < 5 —Å–µ–∫

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-ALGO-001: –ò–¥–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–≤—Å–µ —Å–ª–æ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã)
// –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
const baristas = [
  { id: '1', available: [8,9,10,11,12] },
  { id: '2', available: [10,11,12,13,14] },
  { id: '3', available: [8,9,10] }
];
const template = [8,9,10,11,12,13,14]; // 7 —Å–ª–æ—Ç–æ–≤
const result = await generateSchedule('2025-01-13');
// –û–∂–∏–¥–∞–Ω–∏–µ: 
// - uncoveredSlots: 0
// - baristaLoads: { '1': 5, '2': 5, '3': 3 } (–∏–ª–∏ –±–ª–∏–∑–∫–æ)

// TC-ALGO-002: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞—Ä–∏—Å—Ç–∞
const baristas = [{ id: '1', available: [8,9] }];
const template = [8,9,10,11,12];
const result = await generateSchedule('2025-01-13');
// –û–∂–∏–¥–∞–Ω–∏–µ: uncoveredSlots: 3 (10,11,12 –Ω–µ –∑–∞–∫—Ä—ã—Ç—ã)

// TC-ALGO-003: –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
const baristas = [
  { id: '1', available: [8,9,10] },
  { id: '2', available: [8,9] }
];
// –°–ª–æ—Ç 10:00 –∏–º–µ–µ—Ç —Ç–æ–ª—å–∫–æ 1 –±–∞—Ä–∏—Å—Ç–∞ ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º
```

---

**–§—É–Ω–∫—Ü–∏—è: `submitShiftReport(shiftId, turnover, confirmedHours)`**

**Unit —Ç–µ—Å—Ç—ã:**
- ‚úÖ –û–±–æ—Ä–æ—Ç > 0
- ‚úÖ –ß–∞—Å—ã > 0
- ‚úÖ –°—Ç–∞—Ç—É—Å —Å–º–µ–Ω—ã –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "completed"
- ‚úÖ –ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç –¥–ª—è –±—É–¥—É—â–µ–π —Å–º–µ–Ω—ã
- ‚úÖ –ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç –¥–≤–∞–∂–¥—ã (idempotency)

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-REPORT-001: –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç—á—ë—Ç
await submitShiftReport('shift-123', 15000, 1.5);
// –û–∂–∏–¥–∞–Ω–∏–µ: 
// - shift_reports —Å–æ–∑–¥–∞–Ω
// - shifts.status = 'completed'

// TC-REPORT-002: –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –æ–±–æ—Ä–æ—Ç
await submitShiftReport('shift-123', -5000, 1);
// –û–∂–∏–¥–∞–Ω–∏–µ: { error: 'Turnover must be positive' }

// TC-REPORT-003: –ë—É–¥—É—â–∞—è —Å–º–µ–Ω–∞
await submitShiftReport('future-shift-id', 10000, 1);
// –û–∂–∏–¥–∞–Ω–∏–µ: { error: 'Cannot report future shifts' }

// TC-REPORT-004: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
await submitShiftReport('shift-123', 15000, 1);
await submitShiftReport('shift-123', 20000, 1); // –¥—É–±–ª–∏–∫–∞—Ç
// –û–∂–∏–¥–∞–Ω–∏–µ: { error: 'Report already submitted' }
```

---

**–§—É–Ω–∫—Ü–∏—è: `calculateSalary(userId, weekStart)`**

**Unit —Ç–µ—Å—Ç—ã:**
- ‚úÖ –§–æ—Ä–º—É–ª–∞: (hours √ó 150) + (turnover √ó 0.05)
- ‚úÖ –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ completed —Å–º–µ–Ω—ã
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É salaries
- ‚úÖ –ü–µ—Ä–µ—Å—á—ë—Ç –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (upsert)

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-SALARY-001: –ü—Ä–æ—Å—Ç–æ–π —Ä–∞—Å—á—ë—Ç
// –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
// - 10 —á–∞—Å–æ–≤ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ
// - –æ–±–æ—Ä–æ—Ç 50000‚ÇΩ
const result = await calculateSalary('user-123', '2025-01-13');
// –û–∂–∏–¥–∞–Ω–∏–µ: salary = (10 √ó 150) + (50000 √ó 0.05) = 4000‚ÇΩ

// TC-SALARY-002: –¢–æ–ª—å–∫–æ completed —Å–º–µ–Ω—ã
// –°–º–µ–Ω—ã: [completed: 5—á, planned: 3—á, completed: 2—á]
// –û–∂–∏–¥–∞–Ω–∏–µ: —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ 5 + 2 = 7 —á–∞—Å–æ–≤

// TC-SALARY-003: –ù–µ—Ç completed —Å–º–µ–Ω
// –û–∂–∏–¥–∞–Ω–∏–µ: salary = 0
```

---

### 1.2 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Frontend

#### –ú–æ–¥—É–ª—å: AvailabilitySelector

**Component —Ç–µ—Å—Ç—ã (React Testing Library + Vitest):**
- ‚úÖ –†–µ–Ω–¥–µ—Ä–∏—Ç—Å—è 7 –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
- ‚úÖ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —á–∞—Å—ã —Å–æ–≥–ª–∞—Å–Ω–æ —à–∞–±–ª–æ–Ω—É
- ‚úÖ –ö–ª–∏–∫ –ø–æ —á–∞—Å—É –≤—ã–¥–µ–ª—è–µ—Ç –µ–≥–æ
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ —Å–Ω–∏–º–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –∞–∫—Ç–∏–≤–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω ‚â•1 —á–∞—Å
- ‚úÖ –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ backend

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-AVAIL-001: –í—ã–±–æ—Ä —á–∞—Å–æ–≤ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∫–Ω–æ–ø–∫—É
import { render, screen, fireEvent } from '@testing-library/react';

test('–≤—ã–±–æ—Ä —á–∞—Å–æ–≤ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', () => {
  render(<AvailabilitySelector />);
  
  const hourButton = screen.getByTestId('hour-0-8');
  fireEvent.click(hourButton);
  
  const saveButton = screen.getByText('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å');
  expect(saveButton).not.toBeDisabled();
});

// TC-AVAIL-002: –ë–µ–∑ –≤—ã–±–æ—Ä–∞ –∫–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
test('–±–µ–∑ –≤—ã–±–æ—Ä–∞ —á–∞—Å–æ–≤ –∫–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞', () => {
  render(<AvailabilitySelector />);
  const saveButton = screen.getByText('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å');
  expect(saveButton).toBeDisabled();
});

// TC-AVAIL-003: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ —Å–Ω–∏–º–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ
test('–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ —Å–Ω–∏–º–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ', () => {
  render(<AvailabilitySelector />);
  const hourButton = screen.getByTestId('hour-0-8');
  
  fireEvent.click(hourButton);
  expect(hourButton).toHaveClass('selected');
  
  fireEvent.click(hourButton);
  expect(hourButton).not.toHaveClass('selected');
});

// TC-AVAIL-004: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
test('—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ backend', async () => {
  const mockSave = vi.fn();
  render(<AvailabilitySelector onSave={mockSave} />);
  
  fireEvent.click(screen.getByTestId('hour-0-8'));
  fireEvent.click(screen.getByText('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'));
  
  await waitFor(() => {
    expect(mockSave).toHaveBeenCalledWith([{ day: 0, hour: 8 }]);
  });
});
```

---

#### –ú–æ–¥—É–ª—å: ScheduleView (–≥—Ä–∞—Ñ–∏–∫ –±–∞—Ä–∏—Å—Ç–∞)

**Component —Ç–µ—Å—Ç—ã:**
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–º–µ–Ω—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –°–º–µ–Ω—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –¥–∞—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –°—Ç–∞—Ç—É—Å —Å–º–µ–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –µ—Å–ª–∏ –Ω–µ—Ç —Å–º–µ–Ω

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-SCHEDULE-001: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–º–µ–Ω
test('–æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å–º–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', () => {
  const shifts = [
    { id: '1', day: 0, hour: 8, status: 'planned' },
    { id: '2', day: 1, hour: 10, status: 'planned' }
  ];
  render(<ScheduleView shifts={shifts} />);
  
  expect(screen.getAllByTestId('shift-card')).toHaveLength(2);
});

// TC-SCHEDULE-002: –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
test('—Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–º–µ–Ω', () => {
  render(<ScheduleView shifts={[]} />);
  expect(screen.getByText('–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–º–µ–Ω')).toBeInTheDocument();
});
```

---

#### –ú–æ–¥—É–ª—å: ActiveShift (—Ç–µ–∫—É—â–∞—è —Å–º–µ–Ω–∞)

**Component —Ç–µ—Å—Ç—ã:**
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è —Å–º–µ–Ω—ã (¬±15 –º–∏–Ω—É—Ç)
- ‚úÖ –¢–∞–π–º–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–Ø –Ω–∞ —Å–º–µ–Ω–µ" –¥–æ—Å—Ç—É–ø–Ω–∞ –æ–¥–∏–Ω —Ä–∞–∑
- ‚úÖ –ü–æ—Å–ª–µ –∫–ª–∏–∫–∞ —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-ACTIVE-001: –°–º–µ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è
test('—Å–º–µ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è', () => {
  vi.setSystemTime(new Date('2025-01-13T08:05:00'));
  const shift = { start: '08:00', end: '09:00' };
  
  render(<ActiveShift shift={shift} />);
  expect(screen.getByText('–í–∞—à–∞ —Å–º–µ–Ω–∞ —Å–µ–π—á–∞—Å')).toBeInTheDocument();
});

// TC-ACTIVE-002: –°–º–µ–Ω–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–Ω–µ –≤—Ä–µ–º–µ–Ω–∏
test('—Å–º–µ–Ω–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–Ω–µ –≤—Ä–µ–º–µ–Ω–∏', () => {
  vi.setSystemTime(new Date('2025-01-13T07:30:00'));
  const shift = { start: '08:00', end: '09:00' };
  
  render(<ActiveShift shift={shift} />);
  expect(screen.queryByText('–í–∞—à–∞ —Å–º–µ–Ω–∞ —Å–µ–π—á–∞—Å')).not.toBeInTheDocument();
});
```

---

#### –ú–æ–¥—É–ª—å: ShiftReportForm (–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–º–µ–Ω—ã)

**Component —Ç–µ—Å—Ç—ã:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: –æ–±–æ—Ä–æ—Ç > 0
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ —á–∞—Å—ã –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω—ã
- ‚úÖ –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-REPORT-001: –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
test('—É—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á—ë—Ç–∞', async () => {
  const mockSubmit = vi.fn();
  render(<ShiftReportForm onSubmit={mockSubmit} />);
  
  fireEvent.change(screen.getByLabelText('–û–±–æ—Ä–æ—Ç (‚ÇΩ):'), { 
    target: { value: '15000' } 
  });
  fireEvent.click(screen.getByText('–û—Ç–ø—Ä–∞–≤–∏—Ç—å'));
  
  await waitFor(() => {
    expect(mockSubmit).toHaveBeenCalledWith({ turnover: 15000, hours: 1 });
  });
});

// TC-REPORT-002: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä–æ—Ç–∞
test('–æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º –æ–±–æ—Ä–æ—Ç–µ', () => {
  render(<ShiftReportForm />);
  
  const input = screen.getByLabelText('–û–±–æ—Ä–æ—Ç (‚ÇΩ):');
  fireEvent.change(input, { target: { value: '-5000' } });
  
  expect(screen.getByText('–û–±–æ—Ä–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º')).toBeInTheDocument();
});
```

---

#### –ú–æ–¥—É–ª—å: AdminScheduleGrid (–∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å)

**Component —Ç–µ—Å—Ç—ã:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Å–µ –¥–Ω–∏ –∏ —á–∞—Å—ã
- ‚úÖ –¶–≤–µ—Ç —è—á–µ–π–∫–∏: üü• (–Ω–µ –∑–∞–∫—Ä—ã—Ç), üü© (–∑–∞–∫—Ä—ã—Ç)
- ‚úÖ –ö–ª–∏–∫ –ø–æ —è—á–µ–π–∫–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
- ‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–∞—Ä–∏—Å—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç —è—á–µ–π–∫—É

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-ADMIN-001: –°—Ç–∞—Ç—É—Å "–ì—Ä–∞—Ñ–∏–∫ –≥–æ—Ç–æ–≤"
test('—Å—Ç–∞—Ç—É—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ', () => {
  const schedule = [
    { day: 0, hour: 8, assigned: true },
    { day: 0, hour: 9, assigned: true }
  ];
  render(<AdminScheduleGrid schedule={schedule} />);
  
  expect(screen.getByText('‚úÖ –ì—Ä–∞—Ñ–∏–∫ –≥–æ—Ç–æ–≤')).toBeInTheDocument();
});

// TC-ADMIN-002: –ù–µ–∑–∞–∫—Ä—ã—Ç—ã–µ —Å–ª–æ—Ç—ã
test('–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤', () => {
  const schedule = [
    { day: 0, hour: 8, assigned: true },
    { day: 0, hour: 9, assigned: false }
  ];
  render(<AdminScheduleGrid schedule={schedule} />);
  
  expect(screen.getByText('‚ùå –ï—Å—Ç—å –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–µ —Å–ª–æ—Ç—ã (1)')).toBeInTheDocument();
});

// TC-ADMIN-003: –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ
test('–∫–ª–∏–∫ –ø–æ —è—á–µ–π–∫–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ', () => {
  render(<AdminScheduleGrid />);
  
  const cell = screen.getByTestId('slot-0-8');
  fireEvent.click(cell);
  
  expect(screen.getByText('–î–æ—Å—Ç—É–ø–Ω—ã–µ –±–∞—Ä–∏—Å—Ç–∞')).toBeInTheDocument();
});
```

---

#### –ú–æ–¥—É–ª—å: SalariesTable (–∑–∞—Ä–ø–ª–∞—Ç—ã)

**Component —Ç–µ—Å—Ç—ã:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ –±–∞—Ä–∏—Å—Ç–∞
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∏: –∏–º—è, —á–∞—Å—ã, –æ–±–æ—Ä–æ—Ç, –∑–∞—Ä–ø–ª–∞—Ç–∞
- ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV —Ä–∞–±–æ—Ç–∞–µ—Ç

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-SALARY-001: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
test('—Ç–∞–±–ª–∏—Ü–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Å–µ—Ö –±–∞—Ä–∏—Å—Ç–∞', () => {
  const salaries = [
    { name: '–ò–≤–∞–Ω', hours: 10, turnover: 50000, salary: 4000 },
    { name: '–ú–∞—Ä–∏—è', hours: 8, turnover: 30000, salary: 2700 }
  ];
  render(<SalariesTable salaries={salaries} />);
  
  expect(screen.getByText('–ò–≤–∞–Ω')).toBeInTheDocument();
  expect(screen.getByText('4000')).toBeInTheDocument();
});

// TC-SALARY-002: –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞
test('–∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ', () => {
  const salaries = [
    { salary: 4000 },
    { salary: 2700 }
  ];
  render(<SalariesTable salaries={salaries} />);
  
  expect(screen.getByText('6700')).toBeInTheDocument();
});

// TC-SALARY-003: –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
test('—ç–∫—Å–ø–æ—Ä—Ç –≤ CSV', async () => {
  const mockExport = vi.fn();
  render(<SalariesTable onExport={mockExport} />);
  
  fireEvent.click(screen.getByText('–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV'));
  
  await waitFor(() => {
    expect(mockExport).toHaveBeenCalled();
  });
});
```

---

### 1.3 End-to-End —Ç–µ—Å—Ç—ã (Playwright)

**–°—Ü–µ–Ω–∞—Ä–∏–π E2E-001: –ü–æ–ª–Ω—ã–π flow –±–∞—Ä–∏—Å—Ç–∞**
```javascript
test('–±–∞—Ä–∏—Å—Ç–∞: –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å ‚Üí –≥—Ä–∞—Ñ–∏–∫ ‚Üí —Å–º–µ–Ω–∞ ‚Üí –∑–∞—Ä–ø–ª–∞—Ç–∞', async ({ page }) => {
  // 1. –í—Ö–æ–¥ –≤ Mini App
  await page.goto('https://t.me/belka_bot/app');
  await page.waitForSelector('[data-testid="home"]');
  
  // 2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
  await page.click('text=–ú–æ—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å');
  await page.click('[data-testid="hour-0-8"]'); // –ü–Ω 8:00
  await page.click('[data-testid="hour-0-9"]'); // –ü–Ω 9:00
  await page.click('[data-testid="hour-1-10"]'); // –í—Ç 10:00
  await page.click('button:has-text("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")');
  await expect(page.locator('.success')).toBeVisible();
  
  // 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ (–ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –∞–¥–º–∏–Ω —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª)
  await page.click('text=–ú–æ–π –≥—Ä–∞—Ñ–∏–∫');
  const shifts = page.locator('[data-testid="shift-card"]');
  await expect(shifts).toHaveCount(3);
  
  // 4. Mock —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –∫–æ–Ω—Ü–∞ —Å–º–µ–Ω—ã
  await page.evaluate(() => {
    Date.now = () => new Date('2025-01-13T09:05:00').getTime();
  });
  await page.reload();
  
  // 5. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –æ–±–æ—Ä–æ—Ç
  await expect(page.locator('text=–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–º–µ–Ω—ã')).toBeVisible();
  await page.fill('[data-testid="turnover"]', '12000');
  await page.click('button:has-text("–û—Ç–ø—Ä–∞–≤–∏—Ç—å")');
  
  // 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—É
  await page.click('text=–ú–æ—è –∑–∞—Ä–ø–ª–∞—Ç–∞');
  await expect(page.locator('.salary-amount')).toContainText('900'); // (1.5—á √ó 150) + (12000 √ó 0.05)
});
```

**–°—Ü–µ–Ω–∞—Ä–∏–π E2E-002: –ê–¥–º–∏–Ω —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –≥—Ä–∞—Ñ–∏–∫**
```javascript
test('–∞–¥–º–∏–Ω: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ ‚Üí —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ', async ({ page }) => {
  // 1. –í—Ö–æ–¥ –∫–∞–∫ –∞–¥–º–∏–Ω
  await page.goto('https://t.me/belka_bot/app');
  
  // 2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
  await page.click('text=–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å');
  await page.click('text=–ì—Ä–∞—Ñ–∏–∫ –ø–æ —Å–ª–æ—Ç–∞–º');
  
  // 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é
  await page.click('button:has-text("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫")');
  await page.waitForSelector('.generation-complete');
  
  // 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
  const status = page.locator('.week-status');
  await expect(status).toContainText('‚úÖ –ì—Ä–∞—Ñ–∏–∫ –≥–æ—Ç–æ–≤');
  
  // 5. –í—Ä—É—á–Ω—É—é –Ω–∞–∑–Ω–∞—á–∏—Ç—å –±–∞—Ä–∏—Å—Ç–∞ –Ω–∞ —Å–ª–æ—Ç
  await page.click('[data-testid="slot-0-8"]'); // –ü–Ω 8:00
  await page.click('text=–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤');
  await page.click('button:has-text("–ù–∞–∑–Ω–∞—á–∏—Ç—å")');
  
  // 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —è—á–µ–π–∫–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å
  const cell = page.locator('[data-testid="slot-0-8"]');
  await expect(cell).toHaveClass(/filled/);
  await expect(cell).toContainText('–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤');
});
```

**–°—Ü–µ–Ω–∞—Ä–∏–π E2E-003: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
```javascript
test('–±–∞—Ä–∏—Å—Ç–∞ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–º–µ–Ω–µ', async ({ page, context }) => {
  // 1. –°–æ–∑–¥–∞—Ç—å —Å–º–µ–Ω—É –Ω–∞ –∑–∞–≤—Ç—Ä–∞
  // (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–æ–º –∏–ª–∏ —á–µ—Ä–µ–∑ API)
  
  // 2. Mock –≤—Ä–µ–º–µ–Ω–∏: -24 —á–∞—Å–∞ –¥–æ —Å–º–µ–Ω—ã
  await page.evaluate(() => {
    Date.now = () => new Date('2025-01-12T08:00:00').getTime();
  });
  
  // 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å cron job (–≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–µ—Å—Ç–∞)
  await fetch('https://your-edge-function/send-reminders', { method: 'POST' });
  
  // 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
  // (—Ç—Ä–µ–±—É–µ—Ç mock Telegram Bot API)
  const messages = await getTelegramMessages(12345); // telegram_id
  expect(messages).toContainEqual(
    expect.objectContaining({
      text: expect.stringContaining('–≤–∞—à–∞ —Å–º–µ–Ω–∞ –∑–∞–≤—Ç—Ä–∞')
    })
  );
});
```

---

### 1.4 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**Integration —Ç–µ—Å—Ç—ã –¥–ª—è Telegram Bot:**

```javascript
// TC-BOT-001: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 24 —á–∞—Å–∞
test('–æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 24 —á–∞—Å–∞ –¥–æ —Å–º–µ–Ω—ã', async () => {
  const mockBot = vi.fn();
  const shift = { telegram_id: 12345, date: '2025-01-14', hour: 8 };
  
  await sendShiftReminder(shift, mockBot);
  
  expect(mockBot).toHaveBeenCalledWith(
    12345,
    expect.stringContaining('–≤–∞—à–∞ —Å–º–µ–Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 8:00')
  );
});

// TC-BOT-002: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–µ —Å–º–µ–Ω—ã
test('—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Å–º–µ–Ω—ã', async () => {
  vi.setSystemTime(new Date('2025-01-13T08:00:00'));
  const shift = { telegram_id: 12345, start: '08:00' };
  
  await sendShiftStart(shift);
  
  expect(mockBot).toHaveBeenCalledWith(
    12345,
    'üü¢ –í–∞—à–∞ —Å–º–µ–Ω–∞ –Ω–∞—á–∞–ª–∞—Å—å! –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ—Ç–º–µ—Ç–∏—Ç—å—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.'
  );
});

// TC-BOT-003: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–º –æ–±–æ—Ä–æ—Ç–µ
test('–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –µ—Å–ª–∏ –æ–±–æ—Ä–æ—Ç –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞', async () => {
  const shift = {
    telegram_id: 12345,
    end: '09:00',
    report: null
  };
  vi.setSystemTime(new Date('2025-01-13T11:00:00')); // +2 —á–∞—Å–∞
  
  await sendTurnoverReminder(shift);
  
  expect(mockBot).toHaveBeenCalledWith(
    12345,
    expect.stringContaining('–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –æ–±–æ—Ä–æ—Ç')
  );
});
```

---

### 1.5 Performance —Ç–µ—Å—Ç—ã

**Load Testing (Artillery / k6):**

```yaml
# load-test.yml
config:
  target: 'https://your-api.supabase.co'
  phases:
    - duration: 60
      arrivalRate: 10 # 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
    - duration: 120
      arrivalRate: 50 # 50 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É

scenarios:
  - name: "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞"
    flow:
      - post:
          url: "/functions/v1/generate-schedule"
          json:
            weekStart: "2025-01-13"
          expect:
            - statusCode: 200
            - contentType: json
            - hasProperty: "assignments"
  
  - name: "–ß—Ç–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞"
    flow:
      - get:
          url: "/rest/v1/shifts?week_start=eq.2025-01-13"
          headers:
            apikey: "${API_KEY}"
```

**–ú–µ—Ç—Ä–∏–∫–∏:**
- ‚úÖ p50 response time < 200ms
- ‚úÖ p95 response time < 500ms
- ‚úÖ p99 response time < 1000ms
- ‚úÖ Error rate < 1%

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã:**
```javascript
// TC-PERF-001: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –±–æ–ª—å—à–æ–π –∫–æ—Ñ–µ–π–Ω–∏
test('–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è 100 –±–∞—Ä–∏—Å—Ç–∞ –∏ 168 —Å–ª–æ—Ç–æ–≤', async () => {
  const start = Date.now();
  await generateSchedule('2025-01-13');
  const duration = Date.now() - start;
  
  expect(duration).toBeLessThan(5000); // < 5 —Å–µ–∫—É–Ω–¥
});

// TC-PERF-002: –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
test('50 –±–∞—Ä–∏—Å—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –≥—Ä–∞—Ñ–∏–∫', async () => {
  const promises = Array(50).fill().map(() => 
    fetch('/api/shifts?user_id=...').then(r => r.json())
  );
  
  const start = Date.now();
  await Promise.all(promises);
  const duration = Date.now() - start;
  
  expect(duration).toBeLessThan(2000); // < 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –≤—Å–µ—Ö
});
```

---

## üöÄ –ß–ê–°–¢–¨ 2: –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

---

## –≠–¢–ê–ü 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (1 –¥–µ–Ω—å)

### –ó–∞–¥–∞—á–∏

1. ‚úÖ **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ Supabase**
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ supabase.com
   - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç "belka-coffee"
   - –ü–æ–ª—É—á–∏—Ç—å API keys (anon, service_role)

2. ‚úÖ **–°–æ–∑–¥–∞—Ç—å Telegram –±–æ—Ç–∞**
   - –û—Ç–∫—Ä—ã—Ç—å @BotFather –≤ Telegram
   - –ö–æ–º–∞–Ω–¥–∞ `/newbot`
   - –ü–æ–ª—É—á–∏—Ç—å Bot Token
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Menu Button ‚Üí Web App URL (–∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è)

3. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
   ```bash
   git clone https://github.com/andreiparhomenco/belka-coffee.git
   cd belka-coffee
   ```
   
   –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å –Ω—É–ª—è:
   ```bash
   mkdir belka-coffee
   cd belka-coffee
   git init
   git remote add origin https://github.com/andreiparhomenco/belka-coffee.git
   ```

4. ‚úÖ **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Frontend**
   ```bash
   npm create vite@latest frontend -- --template react-ts
   cd frontend
   npm install
   npm install @supabase/supabase-js
   npm install @twa-dev/sdk
   ```

5. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Vercel**
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ vercel.com
   - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Environment Variables

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
belka-coffee/
‚îú‚îÄ‚îÄ frontend/               # React Mini App
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.ts
‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îú‚îÄ‚îÄ migrations/         # SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ functions/          # Edge Functions
‚îÇ   ‚îî‚îÄ‚îÄ config.toml
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îî‚îÄ‚îÄ e2e/
‚îú‚îÄ‚îÄ docs/                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ PLAN.md                 # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

**`.env.example`:**
```env
# Supabase
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key

# Telegram
VITE_BOT_USERNAME=belka_coffee_bot

# Telegram Bot (–¥–ª—è backend)
BOT_TOKEN=your-bot-token
```

**`README.md`:**
```markdown
# Belka Coffee - –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –∑–∞—Ä–ø–ª–∞—Ç—ã –±–∞—Ä–∏—Å—Ç–∞

Telegram Mini App –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ —Ä–∞–±–æ—Ç—ã –∏ —Ä–∞—Å—á—ë—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç –±–∞—Ä–∏—Å—Ç–∞.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `.env.example` ‚Üí `.env`
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `npm install`
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä: `npm run dev`

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Frontend: React + Vite + TypeScript
- Backend: Supabase (PostgreSQL + Edge Functions)
- Hosting: Vercel
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: Telegram Bot API
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (Definition of Done)

- ‚úÖ Supabase –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω, API keys –ø–æ–ª—É—á–µ–Ω—ã
- ‚úÖ Telegram –±–æ—Ç —Å–æ–∑–¥–∞–Ω, token —Å–æ—Ö—Ä–∞–Ω—ë–Ω
- ‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub —Å –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- ‚úÖ Frontend –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (`npm run dev`)
- ‚úÖ Vercel –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –∏ —Å–≤—è–∑–∞–Ω —Å GitHub
- ‚úÖ `.env.example` —Å –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
- ‚úÖ README.md —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

---

## –≠–¢–ê–ü 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö + Auth (2-3 –¥–Ω—è)

### 1.1 Database Schema

#### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

**–§–∞–π–ª: `supabase/migrations/001_create_users.sql`**
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  telegram_id BIGINT UNIQUE NOT NULL,
  name TEXT NOT NULL,
  role TEXT CHECK (role IN ('barista', 'admin')) DEFAULT 'barista',
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ telegram_id
CREATE INDEX idx_users_telegram_id ON users(telegram_id);

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
COMMENT ON TABLE users IS '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (–±–∞—Ä–∏—Å—Ç–∞ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã)';
COMMENT ON COLUMN users.telegram_id IS 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram';
COMMENT ON COLUMN users.role IS '–†–æ–ª—å: barista –∏–ª–∏ admin';
```

**–§–∞–π–ª: `supabase/migrations/002_create_shop_template.sql`**
```sql
-- –®–∞–±–ª–æ–Ω —Ä–∞–±–æ—Ç—ã –∫–æ—Ñ–µ–π–Ω–∏ (–∫–∞–∫–∏–µ —á–∞—Å—ã —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ñ–µ–π–Ω—è)
CREATE TABLE shop_template (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  day_of_week INT CHECK (day_of_week BETWEEN 0 AND 6) NOT NULL, -- 0 = –ü–Ω, 6 = –í—Å
  hour INT CHECK (hour BETWEEN 0 AND 23) NOT NULL,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(day_of_week, hour)
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
CREATE INDEX idx_shop_template_active ON shop_template(is_active, day_of_week, hour);

COMMENT ON TABLE shop_template IS '–®–∞–±–ª–æ–Ω —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –∫–æ—Ñ–µ–π–Ω–∏';
```

**–§–∞–π–ª: `supabase/migrations/003_create_availability.sql`**
```sql
-- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–∞—Ä–∏—Å—Ç–∞
CREATE TABLE availability (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE NOT NULL,
  week_start DATE NOT NULL, -- –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –Ω–µ–¥–µ–ª–∏
  day_of_week INT CHECK (day_of_week BETWEEN 0 AND 6) NOT NULL,
  hour INT CHECK (hour BETWEEN 0 AND 23) NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, week_start, day_of_week, hour)
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_availability_user_week ON availability(user_id, week_start);
CREATE INDEX idx_availability_week ON availability(week_start);

COMMENT ON TABLE availability IS '–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–∞—Ä–∏—Å—Ç–∞ –ø–æ —á–∞—Å–∞–º';
COMMENT ON COLUMN availability.week_start IS '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –Ω–µ–¥–µ–ª–∏ (–¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏)';
```

**–§–∞–π–ª: `supabase/migrations/004_create_shifts.sql`**
```sql
-- –°–º–µ–Ω—ã –±–∞—Ä–∏—Å—Ç–∞
CREATE TABLE shifts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE NOT NULL,
  week_start DATE NOT NULL,
  day_of_week INT CHECK (day_of_week BETWEEN 0 AND 6) NOT NULL,
  hour INT CHECK (hour BETWEEN 0 AND 23) NOT NULL,
  status TEXT CHECK (status IN ('planned', 'confirmed', 'completed')) DEFAULT 'planned',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_shifts_user_week ON shifts(user_id, week_start);
CREATE INDEX idx_shifts_week_status ON shifts(week_start, status);
CREATE INDEX idx_shifts_slot ON shifts(week_start, day_of_week, hour);

COMMENT ON TABLE shifts IS '–ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —Å–º–µ–Ω—ã –±–∞—Ä–∏—Å—Ç–∞';
COMMENT ON COLUMN shifts.status IS 'planned - –Ω–∞–∑–Ω–∞—á–µ–Ω–∞, confirmed - –±–∞—Ä–∏—Å—Ç–∞ –æ—Ç–º–µ—Ç–∏–ª—Å—è, completed - –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—Ç—á—ë—Ç–æ–º';
```

**–§–∞–π–ª: `supabase/migrations/005_create_shift_reports.sql`**
```sql
-- –û—Ç—á—ë—Ç—ã –æ —Å–º–µ–Ω–∞—Ö
CREATE TABLE shift_reports (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  shift_id UUID REFERENCES shifts(id) ON DELETE CASCADE UNIQUE NOT NULL,
  turnover NUMERIC(10,2) CHECK (turnover >= 0) NOT NULL,
  confirmed_hours NUMERIC(4,2) CHECK (confirmed_hours > 0) NOT NULL,
  submitted_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å
CREATE INDEX idx_shift_reports_shift ON shift_reports(shift_id);

COMMENT ON TABLE shift_reports IS '–û—Ç—á—ë—Ç—ã –±–∞—Ä–∏—Å—Ç–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–º–µ–Ω—ã';
COMMENT ON COLUMN shift_reports.turnover IS '–û–±–æ—Ä–æ—Ç –∑–∞ —Å–º–µ–Ω—É (‚ÇΩ)';
COMMENT ON COLUMN shift_reports.confirmed_hours IS '–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —á–∞—Å—ã';
```

**–§–∞–π–ª: `supabase/migrations/006_create_salaries.sql`**
```sql
-- –ó–∞—Ä–ø–ª–∞—Ç—ã
CREATE TABLE salaries (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE NOT NULL,
  week_start DATE NOT NULL,
  total_hours NUMERIC(5,2) NOT NULL,
  total_turnover NUMERIC(12,2) NOT NULL,
  salary NUMERIC(10,2) NOT NULL,
  calculated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, week_start)
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_salaries_user_week ON salaries(user_id, week_start);
CREATE INDEX idx_salaries_week ON salaries(week_start);

COMMENT ON TABLE salaries IS '–†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –∑–∞—Ä–ø–ª–∞—Ç—ã –±–∞—Ä–∏—Å—Ç–∞ –ø–æ –Ω–µ–¥–µ–ª—è–º';
COMMENT ON COLUMN salaries.salary IS '–ò—Ç–æ–≥–æ–≤–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞: (hours √ó 150) + (turnover √ó 0.05)';
```

**–§–∞–π–ª: `supabase/migrations/007_create_audit_log.sql`**
```sql
-- –õ–æ–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
CREATE TABLE audit_log (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  action TEXT NOT NULL,
  table_name TEXT NOT NULL,
  record_id UUID,
  old_data JSONB,
  new_data JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_audit_log_user ON audit_log(user_id);
CREATE INDEX idx_audit_log_table ON audit_log(table_name);
CREATE INDEX idx_audit_log_created ON audit_log(created_at DESC);

COMMENT ON TABLE audit_log IS '–ñ—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ';
```

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Supabase CLI
npm install -g supabase

# –õ–æ–≥–∏–Ω
supabase login

# –°–≤—è–∑–∞—Ç—å —Å –ø—Ä–æ–µ–∫—Ç–æ–º
supabase link --project-ref your-project-ref

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
supabase db push
```

---

### 1.2 Row Level Security (RLS)

**–§–∞–π–ª: `supabase/migrations/008_setup_rls.sql`**
```sql
-- ============================================
-- RLS –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã users
-- ============================================
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

-- –í—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
CREATE POLICY "Users can read all users"
  ON users FOR SELECT
  USING (true);

-- –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å —Ä–æ–ª–∏
CREATE POLICY "Only admins can update users"
  ON users FOR UPDATE
  USING (
    EXISTS (
      SELECT 1 FROM users AS u
      WHERE u.id = auth.uid() AND u.role = 'admin'
    )
  );

-- ============================================
-- RLS –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã availability
-- ============================================
ALTER TABLE availability ENABLE ROW LEVEL SECURITY;

-- –ë–∞—Ä–∏—Å—Ç–∞ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
CREATE POLICY "Baristas can view own availability"
  ON availability FOR SELECT
  USING (
    user_id = auth.uid()
    OR EXISTS (
      SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role = 'admin'
    )
  );

-- –ë–∞—Ä–∏—Å—Ç–∞ –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —Å–≤–æ—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
CREATE POLICY "Baristas can insert own availability"
  ON availability FOR INSERT
  WITH CHECK (user_id = auth.uid());

-- –ë–∞—Ä–∏—Å—Ç–∞ –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å —Å–≤–æ—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
CREATE POLICY "Baristas can delete own availability"
  ON availability FOR DELETE
  USING (user_id = auth.uid());

-- –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å –≤—Å—ë
CREATE POLICY "Admins can manage all availability"
  ON availability FOR ALL
  USING (
    EXISTS (
      SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role = 'admin'
    )
  );

-- ============================================
-- RLS –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã shifts
-- ============================================
ALTER TABLE shifts ENABLE ROW LEVEL SECURITY;

-- –ë–∞—Ä–∏—Å—Ç–∞ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å–º–µ–Ω—ã
CREATE POLICY "Baristas can view own shifts"
  ON shifts FOR SELECT
  USING (
    user_id = auth.uid()
    OR EXISTS (
      SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role = 'admin'
    )
  );

-- –ë–∞—Ä–∏—Å—Ç–∞ –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å —Å–≤–æ–∏—Ö —Å–º–µ–Ω (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)
CREATE POLICY "Baristas can confirm own shifts"
  ON shifts FOR UPDATE
  USING (user_id = auth.uid())
  WITH CHECK (
    user_id = auth.uid()
    AND status IN ('confirmed', 'completed')
  );

-- –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º–∏ —Å–º–µ–Ω–∞–º–∏
CREATE POLICY "Admins can manage all shifts"
  ON shifts FOR ALL
  USING (
    EXISTS (
      SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role = 'admin'
    )
  );

-- ============================================
-- RLS –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã shift_reports
-- ============================================
ALTER TABLE shift_reports ENABLE ROW LEVEL SECURITY;

-- –ë–∞—Ä–∏—Å—Ç–∞ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –æ—Ç—á—ë—Ç—ã
CREATE POLICY "Baristas can view own reports"
  ON shift_reports FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM shifts
      WHERE shifts.id = shift_reports.shift_id
      AND shifts.user_id = auth.uid()
    )
    OR EXISTS (
      SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role = 'admin'
    )
  );

-- –ë–∞—Ä–∏—Å—Ç–∞ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç—á—ë—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö —Å–º–µ–Ω
CREATE POLICY "Baristas can create own reports"
  ON shift_reports FOR INSERT
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM shifts
      WHERE shifts.id = shift_reports.shift_id
      AND shifts.user_id = auth.uid()
    )
  );

-- –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å–µ –æ—Ç—á—ë—Ç—ã
CREATE POLICY "Admins can view all reports"
  ON shift_reports FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role = 'admin'
    )
  );

-- ============================================
-- RLS –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã salaries
-- ============================================
ALTER TABLE salaries ENABLE ROW LEVEL SECURITY;

-- –ë–∞—Ä–∏—Å—Ç–∞ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –∑–∞—Ä–ø–ª–∞—Ç—É
CREATE POLICY "Baristas can view own salary"
  ON salaries FOR SELECT
  USING (
    user_id = auth.uid()
    OR EXISTS (
      SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role = 'admin'
    )
  );

-- –¢–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–∞ (—á–µ—Ä–µ–∑ Edge Functions) –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å/–æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—ã
-- (RLS –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ service_role key)

-- ============================================
-- RLS –¥–ª—è shop_template –∏ audit_log
-- ============================================
ALTER TABLE shop_template ENABLE ROW LEVEL SECURITY;

-- –í—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å —à–∞–±–ª–æ–Ω
CREATE POLICY "Everyone can read shop template"
  ON shop_template FOR SELECT
  USING (true);

-- –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å
CREATE POLICY "Only admins can manage shop template"
  ON shop_template FOR ALL
  USING (
    EXISTS (
      SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role = 'admin'
    )
  );

ALTER TABLE audit_log ENABLE ROW LEVEL SECURITY;

-- –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç audit log
CREATE POLICY "Only admins can view audit log"
  ON audit_log FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role = 'admin'
    )
  );
```

---

### 1.3 Auth —á–µ—Ä–µ–∑ Telegram

**–§–∞–π–ª: `supabase/functions/telegram-auth/index.ts`**
```typescript
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
import { createHmac } from 'https://deno.land/std@0.168.0/node/crypto.ts';

const SUPABASE_URL = Deno.env.get('SUPABASE_URL')!;
const SUPABASE_SERVICE_KEY = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!;
const BOT_TOKEN = Deno.env.get('BOT_TOKEN')!;

serve(async (req) => {
  // CORS
  if (req.method === 'OPTIONS') {
    return new Response('ok', {
      headers: {
        'Access-Control-Allow-Origin': '*',
        'Access-Control-Allow-Methods': 'POST',
        'Access-Control-Allow-Headers': 'Content-Type',
      },
    });
  }

  try {
    const { initData } = await req.json();

    // –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å Telegram WebApp initData
    const isValid = validateTelegramData(initData, BOT_TOKEN);
    if (!isValid) {
      return new Response(JSON.stringify({ error: 'Invalid Telegram data' }), {
        status: 401,
        headers: { 'Content-Type': 'application/json' },
      });
    }

    // –ü–∞—Ä—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    const userData = parseTelegramData(initData);

    // –°–æ–∑–¥–∞—Ç—å Supabase client
    const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY);

    // –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    let { data: user, error } = await supabase
      .from('users')
      .select('*')
      .eq('telegram_id', userData.id)
      .single();

    if (error && error.code === 'PGRST116') {
      // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞—ë–º
      const { data: newUser, error: createError } = await supabase
        .from('users')
        .insert({
          telegram_id: userData.id,
          name: `${userData.first_name} ${userData.last_name || ''}`.trim(),
          role: 'barista', // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        })
        .select()
        .single();

      if (createError) throw createError;
      user = newUser;
    }

    // –°–æ–∑–¥–∞—Ç—å JWT —Ç–æ–∫–µ–Ω –¥–ª—è Supabase Auth
    const { data: session, error: signInError } = await supabase.auth.signInWithPassword({
      email: `${user.telegram_id}@telegram.local`, // —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π email
      password: BOT_TOKEN, // –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å bot token –∫–∞–∫ –ø–∞—Ä–æ–ª—å (–∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
    });

    if (signInError) {
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ Auth, —Å–æ–∑–¥–∞—ë–º
      const { data: authUser, error: signUpError } = await supabase.auth.signUp({
        email: `${user.telegram_id}@telegram.local`,
        password: BOT_TOKEN,
      });
      
      if (signUpError) throw signUpError;
      
      // –¢–µ–ø–µ—Ä—å –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è
      const { data: newSession } = await supabase.auth.signInWithPassword({
        email: `${user.telegram_id}@telegram.local`,
        password: BOT_TOKEN,
      });
      
      return new Response(JSON.stringify({
        user,
        session: newSession,
      }), {
        headers: { 
          'Content-Type': 'application/json',
          'Access-Control-Allow-Origin': '*',
        },
      });
    }

    return new Response(JSON.stringify({
      user,
      session,
    }), {
      headers: { 
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*',
      },
    });

  } catch (err) {
    console.error('Auth error:', err);
    return new Response(JSON.stringify({ error: err.message }), {
      status: 500,
      headers: { 'Content-Type': 'application/json' },
    });
  }
});

// –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram WebApp initData
function validateTelegramData(initData: string, botToken: string): boolean {
  const params = new URLSearchParams(initData);
  const hash = params.get('hash');
  params.delete('hash');

  const dataCheckString = Array.from(params.entries())
    .sort(([a], [b]) => a.localeCompare(b))
    .map(([key, value]) => `${key}=${value}`)
    .join('\n');

  const secretKey = createHmac('sha256', 'WebAppData')
    .update(botToken)
    .digest();

  const calculatedHash = createHmac('sha256', secretKey)
    .update(dataCheckString)
    .digest('hex');

  return calculatedHash === hash;
}

// –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function parseTelegramData(initData: string) {
  const params = new URLSearchParams(initData);
  const userJson = params.get('user');
  return JSON.parse(userJson || '{}');
}
```

**–¢–µ—Å—Ç—ã –¥–ª—è Auth:**

**–§–∞–π–ª: `tests/unit/telegram-auth.test.ts`**
```typescript
import { assertEquals } from 'https://deno.land/std@0.168.0/testing/asserts.ts';

Deno.test('TC-AUTH-001: –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö', () => {
  const initData = 'query_id=...&user=...&hash=correct_hash';
  const isValid = validateTelegramData(initData, 'bot_token');
  assertEquals(isValid, true);
});

Deno.test('TC-AUTH-002: –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ hash', () => {
  const initData = 'query_id=...&user=...&hash=wrong_hash';
  const isValid = validateTelegramData(initData, 'bot_token');
  assertEquals(isValid, false);
});
```

---

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≠—Ç–∞–ø–∞ 1

- ‚úÖ –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ Edge Function `telegram-auth` —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–∞
- ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è Auth –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ú–æ–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ Telegram Mini App
- ‚úÖ –ë–∞—Ä–∏—Å—Ç–∞ –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ

---

## –≠–¢–ê–ü 2: Frontend MVP - –í—ã–±–æ—Ä –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (3-4 –¥–Ω—è)

### 2.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
cd frontend
npm install @supabase/supabase-js
npm install @twa-dev/sdk
npm install react-router-dom
npm install date-fns
npm install vitest @testing-library/react @testing-library/jest-dom
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:**
```
frontend/src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ AvailabilitySelector.tsx
‚îÇ   ‚îú‚îÄ‚îÄ HourButton.tsx
‚îÇ   ‚îú‚îÄ‚îÄ WeekGrid.tsx
‚îÇ   ‚îú‚îÄ‚îÄ Navigation.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Layout.tsx
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îú‚îÄ‚îÄ useAvailability.ts
‚îÇ   ‚îî‚îÄ‚îÄ useTelegram.ts
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ supabaseClient.ts
‚îÇ   ‚îî‚îÄ‚îÄ helpers.ts
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ AvailabilityPage.tsx
‚îÇ   ‚îú‚îÄ‚îÄ SchedulePage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ HomePage.tsx
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ App.tsx
‚îî‚îÄ‚îÄ main.tsx
```

---

### 2.2 Supabase Client

**–§–∞–π–ª: `frontend/src/lib/supabaseClient.ts`**
```typescript
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

export const supabase = createClient(supabaseUrl, supabaseAnonKey);

export type Database = {
  users: {
    id: string;
    telegram_id: number;
    name: string;
    role: 'barista' | 'admin';
  };
  availability: {
    id: string;
    user_id: string;
    week_start: string;
    day_of_week: number;
    hour: number;
  };
  // ... –¥—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã
};
```

---

### 2.3 Auth Hook

**–§–∞–π–ª: `frontend/src/hooks/useAuth.ts`**
```typescript
import { useEffect, useState } from 'react';
import { supabase } from '../lib/supabaseClient';
import WebApp from '@twa-dev/sdk';

export function useAuth() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // –ü–æ–ª—É—á–∏—Ç—å initData –æ—Ç Telegram
    const initData = WebApp.initData;

    if (!initData) {
      console.error('No Telegram initData');
      setLoading(false);
      return;
    }

    // –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Edge Function
    fetch(`${import.meta.env.VITE_SUPABASE_URL}/functions/v1/telegram-auth`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ initData }),
    })
      .then(res => res.json())
      .then(data => {
        if (data.session) {
          supabase.auth.setSession(data.session);
          setUser(data.user);
        }
      })
      .catch(err => console.error('Auth error:', err))
      .finally(() => setLoading(false));
  }, []);

  return { user, loading };
}
```

---

### 2.4 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–±–æ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

**–§–∞–π–ª: `frontend/src/components/AvailabilitySelector.tsx`**
```typescript
import { useState, useEffect } from 'react';
import { useAvailability } from '../hooks/useAvailability';
import { HourButton } from './HourButton';
import { getWeekStart } from '../lib/helpers';

const DAYS = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
const HOURS = Array.from({ length: 13 }, (_, i) => i + 8); // 8-20

export function AvailabilitySelector() {
  const weekStart = getWeekStart(new Date());
  const { availability, saveAvailability, loading } = useAvailability(weekStart);
  const [selected, setSelected] = useState<Set<string>>(new Set());

  useEffect(() => {
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
    if (availability) {
      const selectedSet = new Set(
        availability.map(a => `${a.day_of_week}-${a.hour}`)
      );
      setSelected(selectedSet);
    }
  }, [availability]);

  const toggleHour = (day: number, hour: number) => {
    const key = `${day}-${hour}`;
    const newSelected = new Set(selected);
    
    if (newSelected.has(key)) {
      newSelected.delete(key);
    } else {
      newSelected.add(key);
    }
    
    setSelected(newSelected);
  };

  const handleSave = async () => {
    const slots = Array.from(selected).map(key => {
      const [day, hour] = key.split('-').map(Number);
      return { day_of_week: day, hour };
    });

    await saveAvailability(weekStart, slots);
    alert('–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
  };

  if (loading) return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>;

  return (
    <div className="availability-selector">
      <h2>–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —á–∞—Å—ã</h2>
      
      {DAYS.map((dayName, dayIndex) => (
        <div key={dayIndex} className="day-row">
          <div className="day-label">{dayName}</div>
          <div className="hours-grid">
            {HOURS.map(hour => (
              <HourButton
                key={hour}
                hour={hour}
                isSelected={selected.has(`${dayIndex}-${hour}`)}
                onClick={() => toggleHour(dayIndex, hour)}
                data-testid={`hour-${dayIndex}-${hour}`}
              />
            ))}
          </div>
        </div>
      ))}

      <button 
        onClick={handleSave} 
        disabled={selected.size === 0}
        className="save-button"
      >
        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
      </button>
    </div>
  );
}
```

**–§–∞–π–ª: `frontend/src/components/HourButton.tsx`**
```typescript
interface HourButtonProps {
  hour: number;
  isSelected: boolean;
  onClick: () => void;
}

export function HourButton({ hour, isSelected, onClick, ...props }: HourButtonProps) {
  return (
    <button
      className={`hour-button ${isSelected ? 'selected' : ''}`}
      onClick={onClick}
      {...props}
    >
      {hour}:00
    </button>
  );
}
```

---

### 2.5 Availability Hook

**–§–∞–π–ª: `frontend/src/hooks/useAvailability.ts`**
```typescript
import { useState, useEffect } from 'react';
import { supabase } from '../lib/supabaseClient';

export function useAvailability(weekStart: string) {
  const [availability, setAvailability] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadAvailability();
  }, [weekStart]);

  const loadAvailability = async () => {
    try {
      const { data, error } = await supabase
        .from('availability')
        .select('*')
        .eq('week_start', weekStart);

      if (error) throw error;
      setAvailability(data || []);
    } catch (err) {
      console.error('Error loading availability:', err);
    } finally {
      setLoading(false);
    }
  };

  const saveAvailability = async (weekStart: string, slots: any[]) => {
    try {
      // –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è —ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏
      await supabase
        .from('availability')
        .delete()
        .eq('week_start', weekStart);

      // –í—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—É—é
      const { error } = await supabase
        .from('availability')
        .insert(slots.map(slot => ({
          week_start: weekStart,
          day_of_week: slot.day_of_week,
          hour: slot.hour,
        })));

      if (error) throw error;
      
      // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
      await loadAvailability();
    } catch (err) {
      console.error('Error saving availability:', err);
      throw err;
    }
  };

  return { availability, saveAvailability, loading };
}
```

---

### 2.6 –°—Ç–∏–ª–∏ (–±–∞–∑–æ–≤—ã–µ)

**–§–∞–π–ª: `frontend/src/App.css`**
```css
.availability-selector {
  padding: 20px;
  max-width: 800px;
  margin: 0 auto;
}

.day-row {
  display: flex;
  align-items: center;
  margin-bottom: 12px;
  gap: 12px;
}

.day-label {
  width: 40px;
  font-weight: bold;
}

.hours-grid {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.hour-button {
  padding: 8px 12px;
  border: 2px solid #ddd;
  background: white;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
}

.hour-button:hover {
  border-color: #4CAF50;
}

.hour-button.selected {
  background: #4CAF50;
  color: white;
  border-color: #4CAF50;
}

.save-button {
  margin-top: 24px;
  padding: 12px 32px;
  background: #2196F3;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
}

.save-button:disabled {
  background: #ccc;
  cursor: not-allowed;
}
```

---

### 2.7 –¢–µ—Å—Ç—ã

**–§–∞–π–ª: `frontend/src/components/AvailabilitySelector.test.tsx`**
```typescript
import { describe, test, expect, vi } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { AvailabilitySelector } from './AvailabilitySelector';

describe('AvailabilitySelector', () => {
  test('TC-AVAIL-001: –≤—ã–±–æ—Ä —á–∞—Å–æ–≤ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∫–Ω–æ–ø–∫—É', () => {
    render(<AvailabilitySelector />);
    
    const hourButton = screen.getByTestId('hour-0-8');
    fireEvent.click(hourButton);
    
    const saveButton = screen.getByText('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å');
    expect(saveButton).not.toBeDisabled();
  });

  test('TC-AVAIL-002: –±–µ–∑ –≤—ã–±–æ—Ä–∞ –∫–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞', () => {
    render(<AvailabilitySelector />);
    const saveButton = screen.getByText('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å');
    expect(saveButton).toBeDisabled();
  });

  test('TC-AVAIL-003: –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ —Å–Ω–∏–º–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ', () => {
    render(<AvailabilitySelector />);
    const hourButton = screen.getByTestId('hour-0-8');
    
    fireEvent.click(hourButton);
    expect(hourButton).toHaveClass('selected');
    
    fireEvent.click(hourButton);
    expect(hourButton).not.toHaveClass('selected');
  });
});
```

---

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≠—Ç–∞–ø–∞ 2

- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç AvailabilitySelector —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å/—Å–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —á–∞—Å–æ–≤
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase
- ‚úÖ –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ Unit —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- ‚úÖ UI responsive –∏ —É–¥–æ–±–Ω—ã–π

---

## –≠–¢–ê–ü 3: –ê–ª–≥–æ—Ä–∏—Ç–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ (4-5 –¥–Ω–µ–π)

### 3.1 Edge Function

**–§–∞–π–ª: `supabase/functions/generate-schedule/index.ts`**
```typescript
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

serve(async (req) => {
  try {
    const { weekStart } = await req.json();
    
    const supabase = createClient(
      Deno.env.get('SUPABASE_URL')!,
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
    );

    // 1. –ü–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω –∫–æ—Ñ–µ–π–Ω–∏
    const { data: template } = await supabase
      .from('shop_template')
      .select('*')
      .eq('is_active', true);

    // 2. –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –±–∞—Ä–∏—Å—Ç–∞
    const { data: availability } = await supabase
      .from('availability')
      .select('user_id, day_of_week, hour')
      .eq('week_start', weekStart);

    // 3. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã
    const slots = template.map(t => ({
      day: t.day_of_week,
      hour: t.hour,
      availableBaristas: availability
        .filter(a => a.day_of_week === t.day_of_week && a.hour === t.hour)
        .map(a => a.user_id),
    }));

    // 4. –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–æ—Å—Ç—É–ø–Ω—ã—Ö (ASC)
    slots.sort((a, b) => a.availableBaristas.length - b.availableBaristas.length);

    // 5. –ù–∞–∑–Ω–∞—á–∏—Ç—å –±–∞—Ä–∏—Å—Ç–∞
    const loads = new Map<string, number>();
    const assignments = [];

    for (const slot of slots) {
      if (slot.availableBaristas.length === 0) {
        console.warn(`–°–ª–æ—Ç ${slot.day} ${slot.hour} –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç`);
        continue;
      }

      // –í—ã–±—Ä–∞—Ç—å –±–∞—Ä–∏—Å—Ç–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π
      const barista = slot.availableBaristas.reduce((min, current) => {
        const minLoad = loads.get(min) || 0;
        const currentLoad = loads.get(current) || 0;
        return currentLoad < minLoad ? current : min;
      });

      loads.set(barista, (loads.get(barista) || 0) + 1);

      assignments.push({
        user_id: barista,
        week_start: weekStart,
        day_of_week: slot.day,
        hour: slot.hour,
        status: 'planned',
      });
    }

    // 6. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–º–µ–Ω—ã –∏ –≤—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ
    await supabase
      .from('shifts')
      .delete()
      .eq('week_start', weekStart);

    const { error } = await supabase
      .from('shifts')
      .insert(assignments);

    if (error) throw error;

    return new Response(JSON.stringify({
      success: true,
      totalSlots: slots.length,
      assignedSlots: assignments.length,
      uncoveredSlots: slots.length - assignments.length,
      baristaLoads: Object.fromEntries(loads),
    }), {
      headers: { 'Content-Type': 'application/json' },
    });

  } catch (err) {
    return new Response(JSON.stringify({ error: err.message }), {
      status: 500,
      headers: { 'Content-Type': 'application/json' },
    });
  }
});
```

---

### 3.2 –¢–µ—Å—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞

**–§–∞–π–ª: `tests/integration/generate-schedule.test.ts`**
```typescript
import { assertEquals, assertExists } from 'https://deno.land/std@0.168.0/testing/asserts.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

Deno.test('TC-ALGO-001: –≤—Å–µ —Å–ª–æ—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –±–∞—Ä–∏—Å—Ç–∞', async () => {
  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  const supabase = createClient(
    Deno.env.get('SUPABASE_URL')!,
    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
  );

  // –°–æ–∑–¥–∞—Ç—å 3 –±–∞—Ä–∏—Å—Ç–∞
  const baristas = [];
  for (let i = 0; i < 3; i++) {
    const { data } = await supabase.from('users').insert({
      telegram_id: 100000 + i,
      name: `Barista ${i}`,
      role: 'barista',
    }).select().single();
    baristas.push(data);
  }

  // –°–æ–∑–¥–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (–≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ 8-12)
  for (const barista of baristas) {
    for (let hour = 8; hour <= 12; hour++) {
      await supabase.from('availability').insert({
        user_id: barista.id,
        week_start: '2025-01-13',
        day_of_week: 0,
        hour,
      });
    }
  }

  // –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω (5 —Å–ª–æ—Ç–æ–≤)
  for (let hour = 8; hour <= 12; hour++) {
    await supabase.from('shop_template').insert({
      day_of_week: 0,
      hour,
    });
  }

  // –ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
  const response = await fetch('http://localhost:54321/functions/v1/generate-schedule', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ weekStart: '2025-01-13' }),
  });

  const result = await response.json();
  
  assertEquals(result.uncoveredSlots, 0);
  assertExists(result.baristaLoads);
});

Deno.test('TC-ALGO-002: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ', async () => {
  // ... (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ TC-ALGO-001)
  
  const loads = Object.values(result.baristaLoads);
  const max = Math.max(...loads);
  const min = Math.min(...loads);
  const deviation = (max - min) / min;
  
  assertEquals(deviation < 0.3, true); // < 30%
});
```

---

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≠—Ç–∞–ø–∞ 3

- ‚úÖ Edge Function `generate-schedule` —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–∞
- ‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Å–ª–æ—Ç—ã (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –±–∞—Ä–∏—Å—Ç–∞)
- ‚úÖ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∞—Å–æ–≤ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ
- ‚úÖ Integration —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏

---

## –≠–¢–ê–ü 4: –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (5-6 –¥–Ω–µ–π)

_–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏..._

*(–î–∞–ª—å–Ω–µ–π—à–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–∞–ø–æ–≤ 4-10 –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ, –Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ –≤ –¥–∞–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –æ–Ω–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ —Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ–º –≤–∏–¥–µ. –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è –±—É–¥–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö.)*

---

## –≠–¢–ê–ü 5: –°–º–µ–Ω—ã –∏ –æ—Ç—á—ë—Ç—ã (3-4 –¥–Ω—è)

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ActiveShift.tsx
- ShiftReportForm.tsx
- ShiftsList.tsx

**Edge Functions:**
- submit-shift-report.ts
- get-current-shift.ts

---

## –≠–¢–ê–ü 6: –ó–∞—Ä–ø–ª–∞—Ç—ã (2-3 –¥–Ω—è)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- SalariesTable.tsx
- ExportButton.tsx

**Edge Functions:**
- calculate-salaries.ts

---

## –≠–¢–ê–ü 7: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (2-3 –¥–Ω—è)

**Telegram Bot:**
- bot.ts (Node.js –∏–ª–∏ Deno)

**Cron Jobs:**
- send-shift-reminders.ts
- send-turnover-reminders.ts

---

## –≠–¢–ê–ü 8: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ª–æ–≥–∏ (2 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è audit_log
- –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—à–ª–æ–≥–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- Security audit

---

## –≠–¢–ê–ü 9: E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (3-4 –¥–Ω—è)

**Playwright —Ç–µ—Å—Ç—ã:**
- –ü–æ–ª–Ω—ã–π flow –±–∞—Ä–∏—Å—Ç–∞
- –ü–æ–ª–Ω—ã–π flow –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

## –≠–¢–ê–ü 10: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –¥–µ–ø–ª–æ–π (2-3 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
- Code splitting
- –ò–Ω–¥–µ–∫—Å—ã –ë–î
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- Sentry –¥–ª—è –æ—à–∏–±–æ–∫
- Production –¥–µ–ø–ª–æ–π

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –∑–∞–ø—É—Å–∫—É

### Backend
- [ ] –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Edge Functions —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã
- [ ] Cron jobs –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã

### Frontend
- [ ] Mini App —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Auth —á–µ—Ä–µ–∑ Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] Responsive –¥–∏–∑–∞–π–Ω

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Unit —Ç–µ—Å—Ç—ã > 80% –ø–æ–∫—Ä—ã—Ç–∏—è
- [ ] Integration —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] Performance —Ç–µ—Å—Ç—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] RLS –ø—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- [ ] Audit log —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ù–µ—Ç SQL injection —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –î–µ–ø–ª–æ–π
- [ ] Frontend –Ω–∞ Vercel
- [ ] Telegram Bot –∑–∞–ø—É—â–µ–Ω
- [ ] Environment variables –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Monitoring –Ω–∞—Å—Ç—Ä–æ–µ–Ω

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–û–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø–ª–∞–Ω–æ–º**
2. **–í–Ω–µ—Å—Ç–∏ –ø—Ä–∞–≤–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)**
3. **–£—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–ª–∞–Ω**
4. **–ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 0**

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 15 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ß–µ—Ä–Ω–æ–≤–∏–∫, –æ–∂–∏–¥–∞–µ—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

