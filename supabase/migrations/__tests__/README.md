# üß™ –¢–µ—Å—Ç—ã –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç SQL —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Ñ—É–Ω–∫—Ü–∏–π, —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏ RLS –ø–æ–ª–∏—Ç–∏–∫.

---

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ pgTAP (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgTAP –≤ Supabase:**

```sql
CREATE EXTENSION IF NOT EXISTS pgtap;
```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:**

```bash
# –ß–µ—Ä–µ–∑ psql
psql "postgresql://postgres:[PASSWORD]@db.[PROJECT_REF].supabase.co:5432/postgres" \
  -f database.test.sql

# –ß–µ—Ä–µ–∑ Supabase CLI
supabase test db
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Supabase Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `database.test.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –≤—ã–≤–æ–¥–µ

---

## üìã –°–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤

| ‚Ññ | –¢–µ—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|------|----------|
| 1 | –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö 7 —Ç–∞–±–ª–∏—Ü |
| 2 | –ö–æ–ª–æ–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—ã users | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã users |
| 3 | –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ | –ü—Ä–æ–≤–µ—Ä–∫–∞ UNIQUE constraints |
| 4 | CHECK constraints | –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è |
| 5 | –¢—Ä–∏–≥–≥–µ—Ä updated_at | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ |
| 6 | –§—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á—ë—Ç–∞ | –ù–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞—Å—á—ë—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç |
| 7 | RLS –ø–æ–ª–∏—Ç–∏–∫–∏ | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è RLS |
| 8 | Foreign keys | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ |
| 9 | –¢—Ä–∏–≥–≥–µ—Ä audit_log | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| 10 | –ò–Ω–¥–µ–∫—Å—ã | –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ |

---

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
1..7
ok 1 - –¢–∞–±–ª–∏—Ü–∞ users —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ok 2 - –¢–∞–±–ª–∏—Ü–∞ shop_template —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ok 3 - –¢–∞–±–ª–∏—Ü–∞ availability —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ok 4 - –¢–∞–±–ª–∏—Ü–∞ shifts —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ok 5 - –¢–∞–±–ª–∏—Ü–∞ shift_reports —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ok 6 - –¢–∞–±–ª–∏—Ü–∞ salaries —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ok 7 - –¢–∞–±–ª–∏—Ü–∞ audit_log —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö (BEGIN/ROLLBACK)
- –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π
- –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω, –≤—ã —É–≤–∏–¥–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏

---

## üîß Troubleshooting

### –û—à–∏–±–∫–∞: "extension 'pgtap' does not exist"

```sql
-- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
CREATE EXTENSION IF NOT EXISTS pgtap;
```

### –û—à–∏–±–∫–∞: "permission denied"

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ **service_role** key –∏–ª–∏ –∞–∫–∫–∞—É–Ω—Ç —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

---

**–°–æ–∑–¥–∞–Ω–æ:** 15 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ü—Ä–æ–µ–∫—Ç:** Belka Coffee

